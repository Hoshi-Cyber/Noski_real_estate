---
export interface Props {
  title: string;
  desc?: string;
  img?: string;
  href: string;
  date?: string;
  tag?: string;
  cta?: string;
  variant?: 'visual' | 'compact' | 'horizontal';
  showImage?: boolean;
  highlight?: boolean; // featured styling

  /** New: style hooks */
  ctaClass?: string;                 // 'btn-cta' | 'btn-outline' | custom
  imgAttrs?: Record<string, any>;    // { loading, decoding, width, height, ... }
  linkFocusClass?: string;           // override focus ring classes
}

const {
  title,
  desc,
  img = '/images/placeholder.webp',
  href,
  date,
  tag,
  cta = 'Read more â†’',
  variant = 'visual',
  showImage = true,
  highlight = false,

  ctaClass = 'btn-outline',
  imgAttrs,
  linkFocusClass = 'focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[color:var(--color-cta)] rounded-xl',
} = Astro.props as Props;

/* Intrinsic size defaults by layout to reduce CLS */
const defaultImgAttrs =
  variant === 'horizontal'
    ? { loading: 'lazy', decoding: 'async', width: 160, height: 160 }
    : { loading: 'lazy', decoding: 'async', width: 1200, height: 576 };

const finalImgAttrs = { ...defaultImgAttrs, ...(imgAttrs ?? {}) };
---

<a 
  href={href} 
  class={`block group ${linkFocusClass}`}
>
  <article
    class={`rounded-xl border bg-white overflow-hidden transition-all duration-300 shadow-sm hover:shadow-lg hover:-translate-y-1
      ${variant === 'horizontal' ? 'flex flex-row' : 'flex flex-col'}
      ${highlight 
        ? 'border-[color:var(--color-cta)] ring-2 ring-[color:var(--color-cta)] bg-[color:var(--color-cta)/0.05]' 
        : 'border-neutral-200'
      }
    `}
  >
    {showImage && (
      <img
        src={img}
        alt={title}
        class={`object-cover flex-shrink-0 transition-transform duration-300 group-hover:scale-105
          ${variant === 'horizontal' ? 'w-40 h-40' : 'h-48 w-full'}
        `}
        {...finalImgAttrs}
      />
    )}

    <div class="p-4 flex flex-col justify-between flex-1">
      {(tag || date) && (
        <div class="text-xs text-neutral-500 mb-2 flex flex-wrap gap-2">
          {tag && <span class="px-2 py-0.5 rounded bg-neutral-100 text-neutral-600">{tag}</span>}
          {date && <span>{date}</span>}
        </div>
      )}

      <h3 class="font-semibold text-neutral-900 group-hover:text-[color:var(--color-primary)] transition line-clamp-2">
        {title}
      </h3>

      {desc && (
        <p class="mt-2 text-sm text-neutral-600 line-clamp-3">{desc}</p>
      )}

      {cta && (
        <!-- Render CTA as styled text inside the single-link card to avoid nested interactive elements -->
        <span class={`${ctaClass} mt-3 text-sm inline-flex items-center`}>
          {cta}
        </span>
      )}
    </div>
  </article>
</a>
