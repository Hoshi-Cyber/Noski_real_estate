---
import { buildResourceHref, resolveResourceImage } from '../lib/utils/paths';

export interface Props {
  resource: {
    title: string;
    description?: string;
    excerpt?: string;
    slug?: string;
    section?: string;
    heroImage?: string;
    image?: string;
    imagesFolder?: string;
    pubDate?: string | Date;
    highlight?: boolean;
  };
}

const { resource } = Astro.props;

const href = resource.slug
  ? buildResourceHref({ slug: resource.slug, data: { section: resource.section } })
  : '/resources';

const img = resolveResourceImage(
  resource.slug || '',
  resource.section,
  resource.imagesFolder,
  resource.heroImage,
  resource.image
);

const desc = resource.description ?? resource.excerpt ?? '';

const date = resource.pubDate
  ? new Date(resource.pubDate).toLocaleDateString('en-US', {
      year: 'numeric',
      month: 'short',
      day: 'numeric',
    })
  : '';

const tag =
  resource.section?.toLowerCase().replace('_','-') === 'faqs' ? 'FAQs' :
  resource.section?.toLowerCase().replace('_','-') === 'market-reports' ? 'Market Report' :
  resource.section ? resource.section.charAt(0).toUpperCase() + resource.section.slice(1) :
  'Resource';
---

<article class="border rounded-md shadow-sm hover:shadow-md transition bg-white overflow-hidden flex flex-col h-full">
  <a href={href} class="block focus:outline-none focus:ring-2 focus:ring-[color:var(--color-cta)]">
    <img
      src={img}
      alt={resource.title}
      loading="lazy"
      decoding="async"
      width="880"
      height="224"
      class="w-full h-48 object-cover"
    />
  </a>

  <div class="flex flex-col flex-grow p-4">
    <div class="text-xs text-gray-500 uppercase mb-1">{tag}</div>

    <h3 class="text-lg font-semibold leading-snug mb-1">
      <a href={href} class="hover:underline text-primary">
        {resource.title}
      </a>
    </h3>

    <p class="text-sm text-gray-600 flex-grow">{desc}</p>

    <div class="mt-4 flex items-center justify-between text-sm text-gray-500">
      {date && <time datetime={date}>{date}</time>}
      <a href={href} class="text-primary font-medium hover:underline">Read more &rarr;</a>
    </div>
  </div>
</article>
