---
import { getCollection } from 'astro:content';
import MainLayout from '../../../layouts/MainLayout.astro';
import ResourceCard from '../../../components/ResourceCard.astro';

const title = 'Market Reports | Severino Realty';
const description = 'Local trends, quarterly reports, and neighborhood spotlights.';

const normalize = (s = '') => {
  const v = s.toLowerCase().trim();
  if (v === 'faqs' || v === 'faq') return 'faqs';
  if (v === 'market-reports' || v === 'market' || v === 'reports' || v === 'market_reports') return 'market-reports';
  return 'guides';
};

const all = await getCollection('resources');
const reports = all
  .filter((e) => normalize(e.data?.section || '') === 'market-reports')
  .sort((a, b) => {
    const da = a.data?.pubDate ? new Date(a.data.pubDate).getTime() : 0;
    const db = b.data?.pubDate ? new Date(b.data.pubDate).getTime() : 0;
    return db - da || String(a.data?.title || '').localeCompare(String(b.data?.title || ''));
  });
---

<MainLayout {title} {description}>
  <section class="container py-10">
    <header class="mb-8">
      <h1 class="text-3xl font-bold text-primary">Market Reports</h1>
      <p class="text-neutral-600 mt-1">
        Local trends, quarterly reports, and neighborhood spotlights.
      </p>
    </header>

    {reports.length === 0 ? (
      <p class="text-neutral-600">No reports yet. Please check back soon.</p>
    ) : (
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
        {reports.map((e) => (
          <ResourceCard
            resource={{
              title: e.data.title,
              description: e.data.description,
              slug: e.slug,
              section: e.data.section || 'market-reports',
              heroImage: e.data.heroImage,
              image: e.data.image,
              imagesFolder: e.data.imagesFolder,
              pubDate: e.data.pubDate
            }}
          />
        ))}
      </div>
    )}

    <div class="mt-8 flex flex-wrap gap-3">
      <a href="/contact" class="rounded-md px-3 py-2 bg-[color:var(--color-cta)] text-white text-sm">
        Request custom market analysis
      </a>
      <a href="/blog" class="rounded-md px-3 py-2 ring-1 ring-neutral-200 bg-white text-sm">
        Read latest insights
      </a>
    </div>
  </section>
</MainLayout>
