---
import MainLayout from '../../../../layouts/MainLayout.astro';

const title = 'Quarterly Reports | Severino Reality';
const description = 'Quarter-over-quarter trends with downloadable PDFs.';

const reports = [
  { id:'2025-q2', year:2025, quarter:2, period:'Q2 2025', area:'Nairobi',  pdfUrl:'#', summary:'Pricing up ~2.1% QoQ. DOM steady. Inventory slightly higher.' },
  { id:'2025-q1', year:2025, quarter:1, period:'Q1 2025', area:'Nairobi',  pdfUrl:'#', summary:'Soft start to the year. Mixed price signals. Faster absorption in core subsectors.' },
  { id:'2024-q4', year:2024, quarter:4, period:'Q4 2024', area:'Nairobi',  pdfUrl:'#', summary:'Year-end clearance effects. Discounts concentrated in older stock.' },
  { id:'2024-q3', year:2024, quarter:3, period:'Q3 2024', area:'Nairobi',  pdfUrl:'#', summary:'Stable pricing. DOM improved. New listings normalised.' },
  { id:'2024-q2', year:2024, quarter:2, period:'Q2 2024', area:'Nairobi',  pdfUrl:'#', summary:'QoQ uptick in transactions. Entry-level apartments led volume.' },
];

const years = Array.from(new Set(reports.map(r=>r.year))).sort((a,b)=>b-a);

// JSON-LD (archive)
const ld = {
  '@context':'https://schema.org',
  '@type':'ItemList',
  itemListElement: reports
    .sort((a,b)=>(b.year*10+b.quarter)-(a.year*10+a.quarter))
    .map((r,i)=>({
      '@type':'ListItem',
      position:i+1,
      item:{ '@type':'CreativeWork', name:`${r.period} Market Report`, url:`/resources/market-reports/quarterly#${r.id}` }
    }))
};
---
<MainLayout {title} {description}>
  <section class="max-w-7xl mx-auto px-4 py-8 md:py-10">
    <header class="mb-6 md:mb-8">
      <h1 class="text-2xl md:text-3xl font-bold text-primary">Quarterly Reports</h1>
      <p class="mt-2 text-neutral-700">Compare quarters and download PDFs. Filter or search to find a specific period.</p>

      <div class="mt-4 flex flex-col sm:flex-row gap-3 sm:items-center">
        <label class="text-sm text-neutral-700 flex items-center gap-2">
          <span>Year</span>
          <select id="filter-year" class="rounded-md ring-1 ring-neutral-300 px-2 py-2 text-sm">
            <option value="all">All years</option>
            {years.map(y => <option value={y}>{y}</option>)}
          </select>
        </label>
        <input id="search" type="search" placeholder="Search e.g. “Q2 2025”"
               class="w-full sm:max-w-xs rounded-md ring-1 ring-neutral-300 px-3 py-2 text-sm"
               aria-label="Search quarterly reports" />
        <label class="text-sm text-neutral-700 flex items-center gap-2">
          <span>Sort</span>
          <select id="sort" class="rounded-md ring-1 ring-neutral-300 px-2 py-2 text-sm">
            <option value="newest">Newest first</option>
            <option value="oldest">Oldest first</option>
          </select>
        </label>
      </div>
    </header>

    <div id="list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
      {reports.map(r => (
        <article id={r.id} class="rounded-md ring-1 ring-neutral-200 bg-white p-4"
                 data-year={r.year} data-quarter={r.quarter} data-title={`${r.period} ${r.area}`}>
          <header class="mb-2">
            <h2 class="text-lg font-semibold text-primary">{r.period}</h2>
            <p class="text-xs text-neutral-500">{r.area}</p>
          </header>
          <p class="text-sm text-neutral-700">{r.summary}</p>
          <div class="mt-3 flex items-center gap-3">
            <a href={r.pdfUrl} class="rounded-md px-3 py-2 bg-[color:var(--color-cta)] text-white text-sm" rel="nofollow">Download PDF</a>
            <a href="/resources/market-reports/current" class="text-sm text-[color:var(--color-cta)] hover:underline">View current snapshot</a>
          </div>
        </article>
      ))}
    </div>

    <div class="mt-8 flex flex-wrap gap-3">
      <a href="/resources/market-reports/current" class="rounded-md px-3 py-2 ring-1 ring-neutral-200 bg-white text-sm">Current snapshot</a>
      <a href="/resources/market-reports/local-spotlights" class="rounded-md px-3 py-2 ring-1 ring-neutral-200 bg-white text-sm">Local spotlights</a>
      <a href="/contact" class="rounded-md px-3 py-2 bg-[color:var(--color-cta)] text-white text-sm">Request custom market analysis</a>
    </div>

    <script type="application/ld+json">{JSON.stringify(ld)}</script>

    <script type="module" client:load>
      const list = document.getElementById('list');
      const selYear = document.getElementById('filter-year');
      const selSort = document.getElementById('sort');
      const search = document.getElementById('search');

      function key(el){ return (+el.dataset.year)*10 + (+el.dataset.quarter); }

      function apply(){
        const y = selYear?.value || 'all';
        const term = (search?.value || '').toLowerCase();
        const cards = Array.from(list.querySelectorAll('article'));

        // filter by year + search
        cards.forEach(c => {
          const inYear = (y === 'all') || (String(c.dataset.year) === y);
          const t = (c.dataset.title || '').toLowerCase();
          c.classList.toggle('hidden', !(inYear && (!term || t.includes(term))));
        });

        // sort visible
        const visible = cards.filter(c => !c.classList.contains('hidden'));
        const dir = selSort?.value === 'oldest' ? 1 : -1;
        visible.sort((a,b)=> dir * (key(a) - key(b)));
        visible.forEach(c => list.appendChild(c));
      }

      selYear?.addEventListener('change', apply);
      selSort?.addEventListener('change', apply);
      search?.addEventListener('input', apply);
      apply();

      // Jump to hash if present
      const hash = location.hash.slice(1);
      if (hash){
        const el = document.getElementById(hash);
        if (el){ el.scrollIntoView({ behavior: 'smooth', block: 'start' }); el.classList.add('ring-[color:var(--color-accent)]'); setTimeout(()=>el.classList.remove('ring-[color:var(--color-accent)]'), 1200); }
      }
    </script>
  </section>
</MainLayout>
