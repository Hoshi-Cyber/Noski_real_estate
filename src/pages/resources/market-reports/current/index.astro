---
import MainLayout from '../../../../layouts/MainLayout.astro';
import Breadcrumbs from '../../../../components/resources/Breadcrumbs.astro';

const title = 'Current Market Snapshot | Severino Realty';
const description = 'Live snapshot of pricing, speed, and supply. Updated regularly.';

/** KPI cards */
const kpis = [
  { label: 'Median Price', value: '—' },
  { label: 'Days on Market', value: '—' },
  { label: 'Inventory (Active)', value: '—' },
];

/** Metrics table (placeholders) */
const metrics = [
  { name: 'Median Sale Price', value: '—' },
  { name: 'Price per m²', value: '—' },
  { name: 'Days on Market (Median)', value: '—' },
  { name: 'List-to-Sale Ratio', value: '—' },
  { name: 'New Listings (30d)', value: '—' },
  { name: 'Active Listings', value: '—' },
  { name: 'Absorption (mo.)', value: '—' },
];

/** Inline trend chart points (replace with real data) */
const points = [
  {x:0,y:98},{x:1,y:102},{x:2,y:101},{x:3,y:105},{x:4,y:107},{x:5,y:106},{x:6,y:110}
];
function toPath(pts){
  if (!pts?.length) return '';
  const yVals = pts.map(p=>p.y);
  const yMin = Math.min(...yVals), yMax = Math.max(...yVals) || 1;
  const xMax = pts.length - 1 || 1;
  const norm = pts.map((p,i)=>({ x:(i/xMax)*100, y:(1 - (p.y - yMin)/(yMax - yMin || 1))*100 }));
  return norm.map((p,i)=> i===0?`M ${p.x},${p.y}`:` L ${p.x},${p.y}`).join('');
}
const pathD = toPath(points);

/** JSON-LD (Dataset-like) */
const ld = {
  '@context':'https://schema.org',
  '@type':'Dataset',
  name:'Current Market Snapshot',
  description,
  dateModified: new Date().toISOString().slice(0,10),
  measurementTechnique:'Residential listings and transactions',
  variableMeasured: [
    'Median Sale Price','Price per m²','Days on Market','List-to-Sale Ratio','New Listings','Active Listings','Absorption Months'
  ]
};
---
<MainLayout {title} {description}>
  <section class="section container">
    <Breadcrumbs
      items={[
        { label: 'Home', href: '/' },
        { label: 'Resources', href: '/resources' },
        { label: 'Market Reports', href: '/resources/market-reports' },
        { label: 'Current Snapshot' }
      ]}
      class="mb-6"
    />

    <header class="mb-6 md:mb-8">
      <h1 class="text-2xl md:text-3xl font-bold text-primary">Current Market Snapshot</h1>
      <p class="mt-2 text-neutral-700 max-w-2xl">
        Directional view of pricing, speed, and supply. Use this to time entries and exits.
      </p>
    </header>

    <!-- KPI cards -->
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 sm:max-w-2xl">
      {kpis.map(k => (
        <div class="rounded-md ring-1 ring-neutral-200 bg-white p-3 text-center">
          <div class="text-xs text-neutral-500">{k.label}</div>
          <div class="text-lg font-semibold text-primary">{k.value}</div>
        </div>
      ))}
    </div>

    <!-- Metrics + Chart -->
    <div class="mt-6 grid grid-cols-1 lg:grid-cols-[320px_1fr] gap-6">
      <table class="w-full text-sm rounded-md ring-1 ring-neutral-200 bg-white">
        <tbody>
          {metrics.map(m => (
            <tr class="border-b last:border-0 border-neutral-200">
              <th scope="row" class="text-left px-3 py-2 font-medium text-primary">{m.name}</th>
              <td class="px-3 py-2 text-neutral-700">{m.value}</td>
            </tr>
          ))}
        </tbody>
      </table>

      <figure class="rounded-md ring-1 ring-neutral-200 bg-white p-3">
        <svg viewBox="0 0 100 100" preserveAspectRatio="none" class="w-full h-44" role="img" aria-label="Trend line for recent pricing">
          <rect x="0" y="0" width="100" height="100" fill="none" />
          <path d={pathD} fill="none" stroke="currentColor" class="text-[color:var(--color-primary)]" stroke-width="1.5"/>
        </svg>
        <figcaption class="mt-2 text-xs text-neutral-500">Simple trend preview. Replace with live data when ready.</figcaption>
      </figure>
    </div>

    <!-- CTAs -->
    <div class="mt-8 flex flex-wrap gap-3">
      <a href="/contact" class="btn-cta text-sm">Request custom market analysis</a>
      <a href="/resources/market-reports/quarterly" class="rounded-md px-3 py-2 ring-1 ring-neutral-200 bg-white text-sm">View quarterly archive</a>
      <a href="/resources/market-reports/local-spotlights" class="rounded-md px-3 py-2 ring-1 ring-neutral-200 bg-white text-sm">Explore neighborhoods</a>
    </div>

    <script type="application/ld+json">{JSON.stringify(ld)}</script>
  </section>
</MainLayout>
