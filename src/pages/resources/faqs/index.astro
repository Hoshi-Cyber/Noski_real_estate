---
import { getCollection } from 'astro:content';
import MainLayout from '../../../layouts/MainLayout.astro';
import ResourceCard from '../../../components/ResourceCard.astro';

const title = 'FAQs | Severino Realty';
const description = 'Quick answers grouped by Buying, Selling, Renting, and Short-Stay.';

const normalize = (s = '') => {
  const v = s.toLowerCase().trim();
  if (v === 'faqs' || v === 'faq') return 'faqs';
  if (v === 'market-reports' || v === 'market' || v === 'reports' || v === 'market_reports') return 'market-reports';
  return 'guides';
};

const all = await getCollection('resources');
const faqs = all
  .filter((e) => normalize(e.data?.section || '') === 'faqs')
  .sort((a, b) => {
    const da = a.data?.pubDate ? new Date(a.data.pubDate).getTime() : 0;
    const db = b.data?.pubDate ? new Date(b.data.pubDate).getTime() : 0;
    return db - da || String(a.data?.title || '').localeCompare(String(b.data?.title || ''));
  });
---

<MainLayout {title} {description}>
  <section class="py-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <header class="mb-8">
      <h1 class="text-3xl font-bold text-primary">FAQs</h1>
      <p class="text-neutral-600 mt-1">Quick answers across Buying, Selling, Renting & Short-Stay.</p>
    </header>

    {faqs.length === 0 ? (
      <p class="text-neutral-600">No FAQs yet. Please check back soon.</p>
    ) : (
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
        {faqs.map((e) => (
          <ResourceCard
            resource={{
              title: e.data.title,
              description: e.data.description,
              slug: e.slug,
              section: e.data.section || 'faqs',
              heroImage: e.data.heroImage,
              image: e.data.image,
              imagesFolder: e.data.imagesFolder,
              pubDate: e.data.pubDate
            }}
          />
        ))}
      </div>
    )}
  </section>
</MainLayout>
